<html>
<head>
    <title>PNets</title>
    <script src="scripts/jquery-1.9.1.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    
    <link rel="stylesheet" href="css/bootstrap_override.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="scripts/raphael-min.js"></script>
    <script src="js/arrows.js"></script>
    <script src="js/pnet.js"></script>
    <script src="js/pnet_run.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/ui.js"></script>
	<style>
	.fa-cog{font-size:36px;color:red;}
    .cursor-hand {
        cursor: pointer;
    }

    .navbar-nav {
        width: 100%;
        text-align: center;
    }
    .navbar-nav > li {
        float: none;
        display: inline-block;
    }

	</style>
</head>
<body onload="onload()" onresize="body_onresize()">
    <div id="wrap">

        <div class="nav navbar-nav  navbar-fixed-top justify-content-center" onclick="">
            <div class="container-fluid ">
                <div class="btn-group">
                    <button class="btn btn-primary btn-sm" id="btnAddTrans">  Display  </button>
                    <button class="btn btn-danger btn-sm" id="btnRun">  Start </button>
                    <button class="btn btn-danger btn-sm" id="btnStop"> Stop  </button>
                    <button class="btn btn-primary btn-sm" style=" visibility: hidden;" id="btnClearPaper">  Delete</button>
                    <button class="btn btn-primary btn-sm" style=" visibility: hidden;" id="btnAddPlace">Place</button>
                    <button class="btn btn-primary btn-sm" style=" visibility: hidden;" id="btnRemoveObj">Remove</button>
                </div>
            </div>
        </div>

        <div class="center-container">
            <div class="center-row" id="center_row" style="">
                
            </div>
        </div>
        <div id="footer" style=" visibility: hidden;">
            <div>
                <span style="float:left;font-family:'Courier New';width: 60px;text-align:right;padding-right:10px;">
                    
                    <i class="fa fa-caret-right" style="font-size:20px;color:silver;" id="status_icon"></i>
                </span>
                <span id="status_bar" style="float:left;color:whitesmoke;font-size:10pt;"></span>
                <span style="float: right; color:silver;font-size:9pt;"> <i>&nbsp;</i>&nbsp;</span>
            </div>
            <div class="container">
            </div>
        </div>
    </div>




</body>
</html>
<script>
    function toolbar_clicked(){
        unselect();
    }
    var paper = null;

    function onload() {
        set_paper();
        ini_button("btnAddTrans", function () { 

            NewTransition(1202,144 ,"Enter Order" );
            NewTransition(2100,50  ,"Enter Order" );
            NewTransition(1280,289 ,"Check stock" );
            NewTransition(1109,282 ,"Check Cridit Card" );
            NewTransition(1211,440 ,"Evaluation" );
            NewTransition(1120,546 ,"Approve" );
            NewTransition(750,295  ,"Reject" );
            NewTransition(822,576  ,"Shipping" );
            NewTransition(816,498  ,"Billing" );
            NewTransition(445,551   ,"Add To Record" );
            NewTransition(1200,40   ,"New User" );    
            
            NewPlace(1,1321,100,1 , "Product chosen");
            NewPlace(2,1064,100,1 , "Login ");
            NewPlace(3,1112,196,0 , "Card Info Added");
            // NewPlace(4,1330,135,1);
            NewPlace(5,1278,203,0 , " Confirm Order");
            NewPlace(6,1105,372,0 , "Card check Result ");
            NewPlace(7,1291,373,0 , "Stock Check Result ");
            NewPlace(8,1220,542,0 , "GOOD/BAD");
            NewPlace(9,952,496,0  , "Pre-Billing");
            NewPlace(10,668,509,0 , "Money Retrieved");
            NewPlace(11,968,568,0 , " Pre-Shipping");
            NewPlace(12,676,583,0 , "Product Shiped");
            NewPlace(13,733,50,0  , "Display Result");
            


            // AddArc(getByKey("P4"),getByKey("T2"));
            // AddArc(getByKey("T2"),getByKey("P1"));
            AddArc(getByKey("P1"),getByKey("T1"));
            AddArc(getByKey("T11"),getByKey("P1"));
            AddArc(getByKey("P2"),getByKey("T1"));
            AddArc(getByKey("T1"),getByKey("P5"));
            AddArc(getByKey("T1"),getByKey("P3"));
            AddArc(getByKey("P5"),getByKey("T3"));
            AddArc(getByKey("P3"),getByKey("T4"));
            AddArc(getByKey("T3"),getByKey("P7"));
            AddArc(getByKey("T4"),getByKey("P6"));
            AddArc(getByKey("P7"),getByKey("T5"));
            AddArc(getByKey("P6"),getByKey("T5"));
            AddArc(getByKey("T5"),getByKey("P8"));
            AddArc(getByKey("P8"),getByKey("T6"));
            AddArc(getByKey("P8"),getByKey("T7"));
            AddArc(getByKey("T6"),getByKey("P9"));
            AddArc(getByKey("T6"),getByKey("P11"));
            AddArc(getByKey("P9"),getByKey("T9"));
            AddArc(getByKey("P11"),getByKey("T8"));
            AddArc(getByKey("T9"),getByKey("P10"));
            AddArc(getByKey("T8"),getByKey("P12"));
            AddArc(getByKey("P12"),getByKey("T10"));
            AddArc(getByKey("P10"),getByKey("T10"));
            AddArc(getByKey("T10"),getByKey("P13"));
            AddArc(getByKey("T7"),getByKey("P13"));
            AddArc(getByKey("P13"),getByKey("T11"));
            AddArc(getByKey("T11"),getByKey("P2"));
        }, "Add transition node");

        ini_button("btnAddPlace", function () {}, "Add place node");
        ini_button("btnRun", function () { run_clicked(); }, "Run Petri Net graph");
        ini_button("btnStop", function () { stop_clicked(); }, "Stop running");

        var elem = null;
        elem = document.getElementById("selected_label");
        elem.onmouseover = function () { set_status("Displays selected object (click to unselect)"); };
        elem.onmouseout = function () { set_status(""); };
        elem = document.getElementById("logo_link");
        elem.onmouseover = function () { set_status("Home page"); };
        elem.onmouseout = function () { set_status(""); };

    }
    function ini_button(id, onclick, tooltip){
        var btn = document.getElementById(id);
        btn.onclick = onclick;
        btn.onmouseover = function () { set_status(tooltip); };
        btn.onmouseout = function () { set_status(""); };
    }
    function open_clicked() {
        if (IsRunning) {
            StopRun();
            set_default_icon();
            unlock_status();
            set_status("");
        }
        document.getElementById('fileinput').click();
    }
    function set_paper() {
        var center_row = document.getElementById("center_row");
        paper = new Raphael("center_row");
        PAPER_WIDTH = center_row.offsetWidth;
        PAPER_HEIGHT = center_row.offsetHeight;
        paper_initialize();
    }
    function clear_paper() {
        ResetPnet();
        paper.clear();
        paper_initialize();
    }
    function body_onresize() {
        if (paper != null) {
            var text = SerializePnet(Places, Trans, Arcs);
            localStorage.setItem("paper_temp", text);
            paper.remove();
            set_paper();
            var pn = JSON.parse(localStorage.getItem("paper_temp"));
            DeserializePnet(pn);
        }
    }
    function paper_initialize()
    {
        set_status("Ready");
    }
    function run_clicked() {
        if (graph_loaded()) {
            set_run_icon();
            set_status("Running...");
            lock_status();
            StartRun();
        }
        else{
            set_status("No valid graph loaded.");
        }
    }
    function set_run_icon()
    {
        document.getElementById("status_icon").className = "fa fa-cog fa-spin";
    }
    function set_default_icon() {
        document.getElementById("status_icon").className = "fa fa-caret-right";
    }
    function stop_clicked() {
        if (IsRunning) {
            set_default_icon();
            unlock_status();
            set_status("Stopped.");
            StopRun();
        }
        else {
            set_status("There is no running graph.");
        }
    }
    function restore_local() {
        clear_paper();
        RestoreFromLocalStorage();
    }
    function sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }
   
    function token_add() {
        if (Selected != null && Selected.node.key.substr(0, 1) == "P") {
            AddToken(Places[Selected.node.key]);
        }
        else {
            set_status("No selected placed.");
        }
    }
    function token_remove() {
        if (Selected != null && Selected.node.key.substr(0, 1) == "P") {
            RemoveToken(Places[Selected.node.key]);
        }
        else {
            set_status("No selected placed.");
        }
    }
   
   
    
    function page_onload() {
        //RestoreSettings();
        paper = Raphael(10, 50, PAPER_WIDTH, PAPER_HEIGHT);
        reset_workspace();
    }

</script>